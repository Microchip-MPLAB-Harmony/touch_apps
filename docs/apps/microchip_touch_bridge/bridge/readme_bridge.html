<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="../../../favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="../../../assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-16"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2724382-16'); </script> <script type="text/javascript" src="../../../assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="../../../assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Touch Bridge Application | Microchip MPLAB Harmony Touch Apps help</title> <meta name="generator" content="Jekyll v3.8.5" /> <meta property="og:title" content="Touch Bridge Application" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Harmony 3 Touch Apps package" /> <meta property="og:description" content="Harmony 3 Touch Apps package" /> <link rel="canonical" href="../../../apps/microchip_touch_bridge/bridge/readme_bridge.html" /> <meta property="og:url" content="../../../apps/microchip_touch_bridge/bridge/readme_bridge.html" /> <meta property="og:site_name" content="Microchip MPLAB Harmony Touch Apps help" /> <script type="application/ld+json"> {"@type":"WebPage","headline":"Touch Bridge Application","url":"../../../apps/microchip_touch_bridge/bridge/readme_bridge.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"../../assets/images/vendor/microchip_mplab_harmony_logo_150_transparent.png"}},"description":"Harmony 3 Touch Apps package","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="../../../index.html" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../index.html" class="nav-list-link">Touch Applications</a><ul class="nav-list "><li class="nav-list-item "><a href="../../../apps/qt1_selfcap_xpro_board/readme.html" class="nav-list-link">QT1 Xplained Pro Self Capacitance Examples</a></li><li class="nav-list-item "><a href="../../../apps/qt7_selfcap_xpro_board/readme.html" class="nav-list-link">QT7 Xplained Pro Touch Examples</a></li><li class="nav-list-item "><a href="../../../apps/t9_selfcap_xpro_board/readme.html" class="nav-list-link">T9 Xplained Pro Touch Examples</a></li><li class="nav-list-item "><a href="../../../apps/qt1_mutualcap_xpro_board/readme.html" class="nav-list-link">QT1 Xplained Pro Mutual Capacitance Examples</a></li><li class="nav-list-item "><a href="../../../apps/t10_mutualcap_xpro_board/readme.html" class="nav-list-link">T10 Xplained Pro Mutual Capacitance Examples</a></li><li class="nav-list-item "><a href="../../../apps/onboard_sensor/readme.html" class="nav-list-link">Onboard Sensor Examples</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../apps/microchip_touch_bridge/readme.html" class="nav-list-link">Microchip Touch Bridge</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../../apps/microchip_touch_bridge/bootloader/readme_bootloader.html" class="nav-list-link">Touch Bridge Bootloader</a> </li><li class="nav-list-item active"> <a href="../../../apps/microchip_touch_bridge/bridge/readme_bridge.html" class="nav-list-link active">Touch Bridge Application</a> </li><li class="nav-list-item "> <a href="../../../apps/microchip_touch_bridge/docs/readme_bridge.html" class="nav-list-link">Touch Bridge Application</a> </li><li class="nav-list-item "> <a href="../../../apps/microchip_touch_bridge/docs/readme_bootloader.html" class="nav-list-link">Touch Bridge Bootloader</a> </li></ul></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Microchip MPLAB Harmony Touch Apps help" aria-label="Search Microchip MPLAB Harmony Touch Apps help" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://support.microchip.com" class="site-button" > Obtain Support from Microchip </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="../../../index.html">Touch Applications</a></li> <li class="breadcrumb-nav-list-item"><a href="../../../apps/microchip_touch_bridge/readme.html">Microchip Touch Bridge</a></li> <li class="breadcrumb-nav-list-item"><span>Touch Bridge Application</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <p><img src="https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_logo.png" alt="Microchip logo" /> <img src="https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_mplab_harmony_logo_small.png" alt="Harmony logo small" /></p> <h1 id="microchip-touch-bridge-application"> <a href="#microchip-touch-bridge-application" aria-labelledby="microchip-touch-bridge-application" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Microchip Touch Bridge Application </h1> <p>The default application has bootloader and bridge firmware combined. Since a valid application is present, the control does not stay in bootloader. By modifying the switch position(Refer to <a href="../../../apps/microchip_touch_bridge/readme.html#Mode-Selection">Mode Selection</a>), user can force to stay in bootloader mode.</p> <p><a href="readme_bootloader.md">Bootloader Readme</a></p> <h2 id="application-overview"> <a href="#application-overview" aria-labelledby="application-overview" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Application Overview </h2> <p>The figure below represents important blocks of the Bridge application. <img src="images/appOverivew.png" alt="Application Overview" /></p> <h3 id="pccomlayer"> <a href="#pccomlayer" aria-labelledby="pccomlayer" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> pcComLayer </h3> <p>This layer has two circular buffers: one to transmit data to the PC and another one to receive data from the PC. The circular buffers are accessed by a set of APIs which can be used to write or read from both Transmit buffers. pcComm layer is not used in CAPBridge mode.</p> <p>pcComm layer is accessed by:</p> <ul> <li>USB/BLE layer to: <ul> <li>Write data to RX buffer</li> <li>Read data to TX buffer</li> </ul> </li> <li>Touch process (or Bypass mode) to: <ul> <li>Write data to TX buffer</li> <li>Read data to RX buffer</li> </ul> </li> </ul> <p>TX and RX terms are related to MCU. <img src="images/pcCommLayer.png" alt="PC Comm Layer" /></p> <h3 id="process-layer"> <a href="#process-layer" aria-labelledby="process-layer" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Process Layer </h3> <p>This layer changes dynamically depending on the mode. All the processing related to data is implemented in this layer. For example, in UART Bypass mode, this layer simply copies data from UART to pcComm layer and vice-versa. In CAPBridge mode, this layer processes the commands received from CAP GUI and sends corresponding I2C commands to CAP devices. If the bridge board is connected to a touch turnkey device (exemplary AT42QT2120), the memory map of the turnkey device is kept in this layer. It also contains the actual driver for the target device. In addition to that, this layer also contains the driver that talks to MPLAB Data Visualizer Touch Plug-in. This layer helps in receiving the data from the turnkey device and repack the data prior to transmitting it to MPLAP Data Visualizer. Similarly, if the data or settings are modified by user in Touch Plug-in (MPLAB DV GUI) they are sent to the target device through this layer. The image below shows some examples of Process Layer. The possible combinations are not limited. <img src="images/processLayer.png" alt="Process Layer" /></p> <h3 id="usb"> <a href="#usb" aria-labelledby="usb" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> USB </h3> <p>The entire application related to the USB is implemented in <a href="../bridge/firmware/src/usbApp.c">usbApp.c</a> file.</p> <ul> <li>In CDC mode: <ul> <li>Copies data from the pcCOMM layer to USB peripheral and the following steps are performed: <ul> <li>Checking for new data to be transmitted</li> <li>If new data is available in pcCOMM, that data is sent to PC.</li> <li>Copies data from USB peripheral to pcCOMM buffer and the following steps are performed:</li> <li>Checking for new data from PC</li> <li>If new data is received from PC, that data is copied to the pcCOMM buffer</li> </ul> </li> </ul> </li> <li>In CAPBridge mode: <ul> <li>USB directly interacts with I2C drivers to read/write data to the CAP devices. The address, read/write instructions from CAP GUI are directly routed to I2C drivers. This part is handled in <a href="../bridge/firmware/src/capBridge.c">capBridge.c</a> files.</li> </ul> </li> </ul> <p>Other than data transaction, the handling of USB connect/disconnect, COMPORT open/close etc are also handled in this layer.</p> <h3 id="bluetooth"> <a href="#bluetooth" aria-labelledby="bluetooth" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Bluetooth </h3> <p>The entire application related to Bluetooth is implemented in <a href="../bridge/firmware/src/btApp.c">btApp.c</a> file.</p> <ul> <li>Sends data from the pcCOMM layer to the RN4678 module</li> <li>Checks for new data to be transmitted</li> <li>If new data is available in pcCOMM, then it sends the data to the PC.</li> <li>Copies data from the RN4678 module to the pcCOMM buffer</li> <li>Checks for new data from the PC</li> <li>If new data is received from the PC, it copies the data to pcCOMM buffer Other than data transaction, the handling of COMPORT open/close etc. are also handled in this layer.</li> </ul> <h3 id="uart-i2c-spi"> <a href="#uart-i2c-spi" aria-labelledby="uart-i2c-spi" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> UART, I2C, SPI </h3> <p>The blocks UART, I2C, SPI provide wrapper functionality to the Harmony 3 drives for easy communication with other layers.</p> <h3 id="led"> <a href="#led" aria-labelledby="led" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> LED </h3> <p>There are four LEDs present in the board:</p> <ul> <li>Blue</li> <li>Red</li> <li>Green</li> <li>Yellow The firmware provides standard APIs to perform blink operation on Red, Green and Yellow LEDs. Blue LED is directly controlled by Bluetooth.</li> </ul> <h3 id="time"> <a href="#time" aria-labelledby="time" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Time </h3> <p>Provides periodic interrupt for time reference and delays needed by firmware. This proves useful if debug data from Touch turnkey parts needs to be read periodically.</p> <h2 id="firmware-components"> <a href="#firmware-components" aria-labelledby="firmware-components" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Firmware Components </h2> <h3 id="usb-1"> <a href="#usb-1" aria-labelledby="usb-1" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> USB </h3> <p>USB can enumerate in two interfaces either CDC or CAPBridge. The descriptors are stored in two different files and depend on the 4-way switch (Refer to article <a href="https://microchipdeveloper.com/touch:introduction-to-microchip-touch-bridge">Introduction to Microchip Touch Bridge</a>). File usb_device_init_data_cdc.c contains the descriptors for CDC Interface and file usb_device_init_data_capBridge contains the descriptor details for CAP Bridge interface. Standard Harmony 3 USB CDC drivers are used for CDC configuration and USB numeration. For CapBridge configuration, vendor class is used and vendor/product IDs are hard coded to match with the <a href="https://www.microchip.com/en-us/products/touch-and-gesture/touch-development-tools">CAP1xxx Touch Tuning GUI</a>. The code related to USB CDC and CAPBridge is present in <a href="../bridge/firmware/src/usbApp.c">usbApp.c</a> file.</p> <h3 id="bluetooth-1"> <a href="#bluetooth-1" aria-labelledby="bluetooth-1" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Bluetooth </h3> <p>Standard UART interface at 115200 baud rate is used to talk to RN4678 Bluetooth module. Flow control is not used in default firmware.</p> <h3 id="touch-device-interfaces"> <a href="#touch-device-interfaces" aria-labelledby="touch-device-interfaces" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Touch device interfaces </h3> <p>Standard driver function from Harmony 3 is used for interfaces like I2C, SPI, UART, GPIO on the header side.</p> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0"><img src='https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_logo.png' /><br />Copyright &copy; 2020 Microchip Technology.</p> <!-- <p class="text-small text-grey-dk-000 mb-0"><img src='../../../assets/images/vendor/microchip_logo.png' /><br /> Copyright &copy; 2023 Microchip Technology.</p> --> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
